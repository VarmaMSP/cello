- include_vars:
    file: passwords.yml
    name: passwords

- name: Set MySQL root user password
  mysql_user:
    name: root
    password: "{{ passwords.root }}"
    host: "{{ item }}"
    priv: "*.*:ALL,GRANT"
    state: present
    login_unix_socket: /var/run/mysqld/mysqld.sock
  loop:
    - 127.0.0.1
    - ::1
    - localhost

- name: Configure MySQL for easy access as root user
  template:
    src: root.my.cnf.j2
    dest: ~/.my.cnf
    mode: 0600

- name: Create admin user
  mysql_user:
    name: admin
    password: "{{ passwords.admin }}"
    host: "{{ item }}"
    priv: "*.*:ALL,GRANT"
    state: present
  loop:
    - 127.0.0.1
    - ::1
    - localhost

- name: Create backup user
  mysql_user:
    name: backup
    password: "{{ passwords.backup }}"
    host: "{{ item }}"
    priv: "*.*:SELECT,LOCK TABLES,RELOAD,PROCESS,TRIGGER,SUPER,REPLICATION CLIENT,SHOW VIEW"
    state: present
  loop:
    - 127.0.0.1
    - ::1
    - localhost

- name: Create read_write user
  mysql_user:
    name: read_write
    password: "{{ passwords.read_write }}"
    host: "{{ item }}"
    priv: "*.*:DELETE,INSERT,SELECT,UPDATE"
    state: present
  loop:
    - 127.0.0.1
    - ::1
    - localhost
